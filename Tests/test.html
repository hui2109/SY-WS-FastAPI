<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>假期设置卡片组件</title>
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
  <!-- Swiper CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/11.2.6/swiper-bundle.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css"
    rel="stylesheet">
  <style>
    .user-card {
      border: 1px solid #e0e0e0;
      border-radius: 12px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .user-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
    }

    .holiday-rule {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 10px;
      border: 1px solid #e9ecef;
    }

    .holiday-stats {
      background: #fff;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 8px;
    }

    .work-schedule {
      background: #e3f2fd;
      border-radius: 8px;
      padding: 15px;
    }

    .schedule-item {
      background: white;
      border-radius: 6px;
      padding: 10px;
      margin-bottom: 8px;
      border: 1px solid #bbdefb;
    }

    .search-container {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 30px 0;
      margin-bottom: 30px;
    }

    .btn-add-rule {
      background: #28a745;
      border: none;
      color: white;
      padding: 8px 16px;
      border-radius: 6px;
      transition: all 0.3s;
    }

    .btn-add-rule:hover {
      background: #218838;
      transform: translateY(-1px);
    }

    .holiday-type-badge {
      font-size: 0.85em;
      padding: 4px 8px;
    }

    .stats-progress {
      height: 6px;
      border-radius: 3px;
    }
  </style>
</head>

<body>
  <!-- 搜索区域 -->
  <div class="search-container">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-md-6">
          <div class="input-group">
            <span class="input-group-text bg-white border-0">
              <i class="bi bi-search"></i>
            </span>
            <input type="text" class="form-control border-0" id="searchInput" placeholder="搜索员工姓名...">
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 卡片容器 -->
  <div class="container">
    <div id="cardsContainer" class="row">
      <!-- 卡片将通过JavaScript动态生成 -->
    </div>
  </div>

  <!-- Bootstrap 5 JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
  <!-- Swiper JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/11.2.6/swiper-bundle.min.js"></script>

  <script>
    // 模拟用户数据
    const userData = [
      {
        id: 1,
        name: "张三",
        avatar: "https://i.pravatar.cc/150?img=1",
        weight: "A级",
        workYears: "5年",
        employeeId: "EMP001",
        phone: "138****1234",
        holidayRules: [
          { type: "年假", startDate: "2024-01-01", endDate: "2024-12-31", days: 15 },
          { type: "婚假", startDate: "2024-06-01", endDate: "2024-06-10", days: 10 }
        ],
        holidayStats: [
          { type: "年假", used: 8, remaining: 7, expiry: "2024-12-31" },
          { type: "病假", used: 2, remaining: 8, expiry: "2024-12-31" },
          { type: "婚假", used: 0, remaining: 10, expiry: "2024-12-31" }
        ],
        workSchedule: {
          month: "2024-05",
          schedules: [
            { type: "2A", count: 15 },
            { type: "休息", count: 8 },
            { type: "加班", count: 3 }
          ]
        }
      },
      {
        id: 2,
        name: "李四",
        avatar: "https://i.pravatar.cc/150?img=2",
        weight: "B级",
        workYears: "3年",
        employeeId: "EMP002",
        phone: "139****5678",
        holidayRules: [
          { type: "年假", startDate: "2024-01-01", endDate: "2024-12-31", days: 15 }
        ],
        holidayStats: [
          { type: "年假", used: 5, remaining: 10, expiry: "2024-12-31" },
          { type: "病假", used: 1, remaining: 9, expiry: "2024-12-31" }
        ],
        workSchedule: {
          month: "2024-05",
          schedules: [
            { type: "2A", count: 18 },
            { type: "休息", count: 6 },
            { type: "夜班", count: 2 }
          ]
        }
      },
      {
        id: 3,
        name: "王五",
        avatar: "https://i.pravatar.cc/150?img=3",
        weight: "A级",
        workYears: "7年",
        employeeId: "EMP003",
        phone: "137****9012",
        holidayRules: [
          { type: "年假", startDate: "2024-01-01", endDate: "2024-12-31", days: 20 },
          { type: "病假", startDate: "2024-03-01", endDate: "2024-03-05", days: 10 }
        ],
        holidayStats: [
          { type: "年假", used: 12, remaining: 8, expiry: "2024-12-31" },
          { type: "病假", used: 3, remaining: 7, expiry: "2024-12-31" }
        ],
        workSchedule: {
          month: "2024-05",
          schedules: [
            { type: "2A", count: 20 },
            { type: "休息", count: 4 },
            { type: "培训", count: 2 }
          ]
        }
      }
    ];

    let allUsers = [...userData];
    let filteredUsers = [...userData];

    // 创建单个卡片
    function createUserCard(user) {
      return `
                <div class="col-lg-12 col-xl-6 mb-4 user-card-wrapper" data-user-name="${user.name}">
                    <div class="user-card p-4">
                        <!-- 用户基本信息 -->
                        <div class="d-flex mb-4">
                            <img src="${user.avatar}" alt="${user.name}" class="user-avatar me-3">
                            <div class="flex-grow-1">
                                <h5 class="mb-1 fw-bold">${user.name}</h5>
                                <div class="small text-muted">
                                    <div class="mb-1"><strong>权重:</strong> ${user.weight}</div>
                                    <div class="mb-1"><strong>工龄:</strong> ${user.workYears}</div>
                                    <div class="mb-1"><strong>工号:</strong> ${user.employeeId}</div>
                                    <div><strong>电话:</strong> ${user.phone}</div>
                                </div>
                            </div>
                        </div>

                        <!-- 假期规则设置 -->
                        <div class="mb-4">
                            <h6 class="fw-bold mb-3">
                                <i class="bi bi-calendar-plus me-2"></i>假期规则设置
                            </h6>
                            <div id="holidayRules-${user.id}">
                                ${user.holidayRules.map((rule, index) => createHolidayRule(user.id, rule, index)).join('')}
                            </div>
                            <button class="btn btn-add-rule btn-sm mt-2" onclick="addHolidayRule(${user.id})">
                                <i class="bi bi-plus-circle me-1"></i>新增规则
                            </button>
                        </div>

                        <!-- 假期统计 -->
                        <div class="mb-4">
                            <h6 class="fw-bold mb-3">
                                <i class="bi bi-bar-chart me-2"></i>假期统计
                            </h6>
                            ${user.holidayStats.map(stat => createHolidayStats(stat)).join('')}
                        </div>

                        <!-- 工作班次统计 -->
                        <div class="work-schedule">
                            <h6 class="fw-bold mb-3">
                                <i class="bi bi-clock me-2"></i>班次统计
                            </h6>
                            <div class="mb-3">
                                <label class="form-label small">统计月份:</label>
                                <input type="month" class="form-control form-control-sm" value="${user.workSchedule.month}">
                            </div>
                            ${user.workSchedule.schedules.map(schedule => createScheduleItem(schedule)).join('')}
                        </div>
                    </div>
                </div>
            `;
    }

    // 创建假期规则
    function createHolidayRule(userId, rule, index) {
      return `
                <div class="holiday-rule">
                    <div class="row g-2 align-items-end">
                        <div class="col-md-3">
                            <label class="form-label small">假期类型</label>
                            <select class="form-select form-select-sm">
                                <option value="年假" ${rule.type === '年假' ? 'selected' : ''}>年假</option>
                                <option value="婚假" ${rule.type === '婚假' ? 'selected' : ''}>婚假</option>
                                <option value="病假" ${rule.type === '病假' ? 'selected' : ''}>病假</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label small">天数</label>
                            <input type="number" class="form-control form-control-sm" value="${rule.days || 0}" min="0" max="365" placeholder="天数">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label small">开始日期</label>
                            <input type="date" class="form-control form-control-sm" value="${rule.startDate}">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label small">结束日期</label>
                            <input type="date" class="form-control form-control-sm" value="${rule.endDate}">
                        </div>
                        <div class="col-md-1">
                            <button class="btn btn-outline-danger btn-sm w-100" onclick="removeHolidayRule(${userId}, ${index})" title="删除规则">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
    }

    // 创建假期统计
    function createHolidayStats(stat) {
      const total = stat.used + stat.remaining;
      const percentage = total > 0 ? (stat.used / total) * 100 : 0;

      return `
                <div class="holiday-stats">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="badge holiday-type-badge bg-primary">${stat.type}</span>
                        <small class="text-muted">过期时间: ${stat.expiry}</small>
                    </div>
                    <div class="row text-center">
                        <div class="col-4">
                            <div class="fw-bold text-danger">${stat.used}</div>
                            <small class="text-muted">已休</small>
                        </div>
                        <div class="col-4">
                            <div class="fw-bold text-success">${stat.remaining}</div>
                            <small class="text-muted">剩余</small>
                        </div>
                        <div class="col-4">
                            <div class="fw-bold text-info">${stat.used + stat.remaining}</div>
                            <small class="text-muted">总计</small>
                        </div>
                    </div>
                    <div class="progress stats-progress mt-2">
                        <div class="progress-bar bg-danger" style="width: ${percentage}%"></div>
                    </div>
                </div>
            `;
    }

    // 创建班次统计项
    function createScheduleItem(schedule) {
      return `
                <div class="schedule-item">
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="fw-bold">${schedule.type}</span>
                        <span class="badge bg-secondary">${schedule.count} 次</span>
                    </div>
                </div>
            `;
    }

    // 渲染所有卡片
    function renderCards() {
      const container = document.getElementById('cardsContainer');
      container.innerHTML = filteredUsers.map(user => createUserCard(user)).join('');
    }

    // 搜索功能
    function setupSearch() {
      const searchInput = document.getElementById('searchInput');
      searchInput.addEventListener('input', function (e) {
        const searchTerm = e.target.value.toLowerCase().trim();

        if (searchTerm === '') {
          filteredUsers = [...allUsers];
        } else {
          filteredUsers = allUsers.filter(user =>
            user.name.toLowerCase().includes(searchTerm)
          );
        }

        renderCards();
      });
    }

    // 添加假期规则
    function addHolidayRule(userId) {
      const user = allUsers.find(u => u.id === userId);
      if (user) {
        const newRule = {
          type: "年假",
          startDate: getCurrentDate(),
          endDate: getCurrentDate(),
          days: 0
        };
        user.holidayRules.push(newRule);
        renderCards();
      }
    }

    // 删除假期规则
    function removeHolidayRule(userId, ruleIndex) {
      const user = allUsers.find(u => u.id === userId);
      if (user && user.holidayRules.length > 1) {
        user.holidayRules.splice(ruleIndex, 1);
        renderCards();
      }
    }

    // 获取当前日期
    function getCurrentDate() {
      return new Date().toISOString().split('T')[0];
    }

    // 初始化
    document.addEventListener('DOMContentLoaded', function () {
      renderCards();
      setupSearch();
    });
  </script>
</body>

</html>